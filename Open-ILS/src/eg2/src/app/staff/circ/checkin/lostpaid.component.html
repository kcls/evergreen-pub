<eg-staff-banner bannerStyle="alert-secondary border border-warning"
  i18n-bannerText bannerText="Checkin Lost &amp; Paid Item">
</eg-staff-banner>

<eg-worklog-strings-components></eg-worklog-strings-components>

<div *ngIf="invalidCheckin" class="alert alert-warning" i18n>
  Information on this page is out of date.
</div>

<div *ngIf="checkinResult">
  <div class="form-validated">
    <div class="row p-2 mt-1" *ngIf="checkinResult.copy">
      <div class="col-lg-4 font-weight-bold" i18n>Item Barcode:</div>
      <div class="col-lg-8">
        <a target="_blank" 
          routerLink="/staff/cat/item/{{checkinResult.copy.id()}}/summary">
          {{checkinResult.copy.barcode()}}
        </a>
      </div>
    </div>
    <div class="row p-2 mt-1" *ngIf="checkinResult.record">
      <div class="col-lg-4 font-weight-bold" i18n>Title:</div>
      <div class="col-lg-8">
        <a target="_blank" 
          routerLink="/staff/catalog/record/{{checkinResult.record.doc_id()}}">
          {{checkinResult.record.title()}}
        </a>
      </div>
    </div>
    <div class="row p-2 mt-1 border-bottom">
      <div class="col-lg-4" i18n>
        <label for="patron-name" class="font-weight-bold">Patron</label>
      </div>
      <div class="col-lg-8">
        <a target="_blank" id="patron-name"
          routerLink="/staff/circ/patron/{{checkinResult.patron.id()}}/checkout">
          {{checkinResult.patron.family_name()}},
          {{checkinResult.patron.first_given_name()}}
          {{checkinResult.patron.second_given_name()}}
        </a>
      </div>
    </div>
    <div class="row p-2 mt-2">
      <div class="col-lg-2 font-weight-bold" i18n>Checked Out:</div>
      <div class="col-lg-2">{{checkinResult.circ.xact_start() | egDate}}</div>
      <div class="col-lg-2 font-weight-bold" i18n>Due Date:</div>
      <div class="col-lg-2">{{checkinResult.circ.due_date() | egDate}}</div>
      <div class="col-lg-2 font-weight-bold" i18n>Item Type:</div>
      <div class="col-lg-2">{{checkinResult.firstEvent.payload.circ_modifier.name()}}</div>
    </div>
    <div class="row p-2 mt-1 border-bottom">
      <div class="col-lg-2 font-weight-bold" i18n>Marked Lost:</div>
      <div class="col-lg-2">{{checkinResult.circ.stop_fines_time() | egDate}}</div>
      <div class="col-lg-2 font-weight-bold" i18n>Last Payment:</div>
      <div class="col-lg-2">{{moneySummary().last_payment_ts() | egDate}}</div>
      <div class="col-lg-2 font-weight-bold" i18n>Payment Type:</div>
      <div class="col-lg-2">
        <ng-container [ngSwitch]="moneySummary().last_payment_type()">
          <ng-container *ngSwitchCase="'cash_payment'" i18n>Cash</ng-container>
          <ng-container *ngSwitchCase="'check_payment'" i18n>Check</ng-container>
          <ng-container *ngSwitchCase="'credit_card_payment'" i18n>Credit Card</ng-container>
          <ng-container *ngSwitchCase="'forgive_payment'" i18n>Forgive</ng-container>
          <ng-container *ngSwitchDefault>{{moneySummary().last_payment_type()}}</ng-container>
        </ng-container>
      </div>
    </div>
    <div class="row p-2 mt-2">
      <div class="col-lg-4">
        <label class="font-weight-bold" for="condition-select" i18n>
          Is item in circulating condition?
        </label>
      </div>
      <div class="col-lg-3">
        <select id="condition-select" name="condition-select" 
          class="form-select" [required]="true" [(ngModel)]="itemCondition">
          <option value="good" i18n>Yes</option>
          <option value="bad" i18n>No</option>
        </select>
      </div>
    </div>
    <div class="row p-2 mt-1" *ngIf="itemCondition === 'bad'">
      <div class="col-lg-12">
        <div class="alert alert-secondary" i18n>
          This item will be set to Discard/Weed status.
        </div>
      </div>
    </div>

    <div class="row p-2 mt-1">
      <div class="col-lg-4">
        <label class="font-weight-bold" for="note-dibs" i18n>Staff Initials</label>
      </div>
      <div class="col-lg-3">
        <input type="text" class="form-control" [(ngModel)]="initials" id="dibs-input"
          [required]="true" i18n-placeholder placeholder="Initials..."/>
      </div>
    </div>

    <div class="row p-2 mt-1" *ngIf="itemCondition">
      <div class="col-lg-12">
        <div class="alert alert-secondary">
          <ng-container 
            *ngIf="refundable() && itemCondition === 'good'" i18n>
            This item is eligible for refund.
          </ng-container>
          <ng-container 
            *ngIf="refundable() && itemCondition !== 'good'" i18n>
            This item will <u>not</u> be refunded since it is not
            in good condition.  If checking the item in results in
            a negative transaction balance, the balance will be
            automatically zero'ed.
          </ng-container>
          <ng-container *ngIf="!refundable()" i18n>
            This item is <u>not</u> eligible for refund.  If checking
            the item in results in a negative transaction balance, the
            balance will be automatically zero'ed.
          </ng-container>
        </div>
      </div>
    </div>

    <div class="row p-2 mt-1" *ngIf="processing">
      <eg-progress-inline></eg-progress-inline>
    </div>

  </div>
  <div class="modal-footer d-flex">
    <button *ngIf="hasCheckinBypassPerms" type="button" class="btn btn-danger" 
      (click)="checkin(true)" i18n>Standard Checkin / No Extra Processing</button>

    <div class="flex-1"></div>

    <button type="button" class="btn btn-warning" (click)="close()" i18n>Cancel Checkin</button>
    <button type="button" class="btn btn-success" (click)="checkin()" 
      [disabled]="!initials || itemCondition === null">
      <ng-container *ngIf="itemCondition === null" i18n>
        Checkin
      </ng-container>
      <ng-container *ngIf="refundable() && itemCondition === 'good'" i18n>
        Checkin &amp; Process Refund
      </ng-container>
      <ng-container *ngIf="!refundable() || itemCondition === 'bad'" i18n>
        Checkin &amp; Mark Item Discard/Weed
      </ng-container>
    </button>
  </div>
</div>

<div class="row">
  <div class="col-lg-12 mt-5">
    <h4 *ngIf="printPreviewHtml" i18n>Preview</h4>                                                
    <div [ngClass]="{'border border-dark w-100': printPreviewHtml}" 
      id="print-preview-pane"></div> 
  </div>
</div>



