<div class="flex">
  <div class="flex-1"></div>

  <div class="w-5/6 md:w-4/6 xl:w-3/6 2xl:w-2/5 p-1 md:p-3 lg:p-5">
    <div class="flex justify-center">
      <h1 i18n>Request an Item</h1>
    </div>

    <div *ngIf="tab === 'create'" class="flex justify-center mt-3">
      <a routerLink="/requests/list" class="border rounded p-2 mat-icon-plus-text" i18n>
        <span class="material-icons mr-2">list</span>
        View My Requests
      </a>
    </div>

    <div *ngIf="tab !== 'create'" class="flex justify-center mt-3">
      <a routerLink="/requests/create" class="border rounded p-2 mat-icon-plus-text" i18n>
        <span class="material-icons mr-2">list</span>
        New Request
      </a>
    </div>

    <div *ngIf="tab === 'create'" class="flex justify-center p-2 mt-4">
      <div>
        <p i18n>
          Thank you for suggesting we buy or borrow an item for the
          King County Library System (KCLS) collection. Due to the
          large number of requests KCLS receives, we cannot get every
          title. We appreciate your understanding.
        </p>
        <p class="mt-3" i18n>
          Holds will be placed on items we are able to buy or borrow
          through Interlibrary Loan (ILL) for pick up at your preferred
          library location. The status of item requests is available
          under <a routerLink="/requests/list">View My Requests</a>.
        </p>
        <p class="mt-3" i18n>
          Need to update your notification preferences? 
          <a target="_blank" href="https://kcls.org/ask/">Contact Ask KCLS</a>
          or visit your local community library.
        </p>
        <p class="mt-3">
          <mat-checkbox [formControl]="controls.ill_opt_out" i18n>
            Opt out: I would like this item considered only for purchase. 
            Please do not attempt to borrow through Interlibrary Loan if 
            not available for purchase.
          </mat-checkbox>
        </p>
      </div>
    </div>

    <div *ngIf="tab === 'create'" class="flex p-2 mt-4">
      <mat-form-field class="flex-1">
        <mat-label i18n>Select a Format</mat-label>
        <mat-select [formControl]="controls.format">
          <mat-option value="book" i18n>Book</mat-option>
          <mat-option value="large-print" i18n>Large Print</mat-option>
          <mat-option value="audiobook" i18n>Audiobook</mat-option>
          <mat-option value="cd" i18n>Music CD</mat-option>
          <mat-option value="dvd" i18n>DVD</mat-option>
          <mat-option value="ebook-eaudio" i18n>eBook / eAudio</mat-option>
          <mat-option value="article" i18n>Magazine / Newspaper / Journal Article</mat-option>
          <mat-option value="subscription" i18n>Magazine / Newspaper Subscription</mat-option>
          <mat-option value="microfilm" i18n>Microfilm</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div *ngIf="controls.format.value === 'ebook-eaudio'" 
      class="mt-5 flex justify-center border rounded border-orange-400 p-4">
      <p i18n>
        Log into 
        <a target="_blank" href="https://libbyapp.com/library/kcls">Libby</a>
        to suggest an eBook / eAudio purchase. Need help? 
        <a href="https://kcls.org/faqs/how-do-i-suggest-an-ebook-for-purchase/">
          See our FAQ
        </a>.
      </p>
    </div>

    <div *ngIf="controls.format.value === 'subscription'" 
      class="mt-5 flex justify-center border rounded border-orange-400 p-4">
      <p i18n>
        Magazine and Newspaper subscription requests are reviewed yearly
        and may take some time to fill if approved.
      </p>
    </div>

    <ng-container *ngIf="typeCanBeRequested() || tab === 'list' || app.getAuthSession()">
      <div class="flex justify-center mt-4 mb-4 border rounded p-3"
        *ngIf="!app.getAuthSession()">
        <h3 i18n>Start by Verifying Your Library Account</h3>
      </div>

      <div class="mt-4">
        <app-login [barcodeOnly]="true"></app-login>
      </div>
    </ng-container>

    <ng-container *ngIf="typeCanBeRequested() || tab === 'list'">
      <ng-container *ngIf="app.getAuthSession()">
        <ng-container *ngIf="!requests.requestsAllowed">
          <div class="mt-5 flex justify-center border rounded border-orange-400 p-4">
            <ng-container *ngIf="requests.tooManyActiveRequests()">
              <p i18n>Patrons are allowed to have at most {{requests.maxRequestCount}} active requests.</p>
            </ng-container>
            <ng-container *ngIf="!requests.tooManyActiveRequests()">
              <p i18n>This account does not have permission to create new requests.</p>
            </ng-container>
          </div>
        </ng-container>
        <ng-container *ngIf="requests.requestsAllowed">
          <nav class="mt-10" mat-tab-nav-bar [tabPanel]="tabPanel">
            <a mat-tab-link routerLink="/requests/create" [active]="tab === 'create'" i18n>
              Create a New Request
            </a>
            <a mat-tab-link routerLink="/requests/list" [active]="tab === 'list'" i18n>
              View My Requests
            </a>
          </nav>
          <mat-tab-nav-panel #tabPanel>
            <div class="mt-10">
              <router-outlet></router-outlet>
            </div>
          </mat-tab-nav-panel>
        </ng-container>
      </ng-container>
    </ng-container>

    <div class="mt-5 flex justify-center border rounded border-grey-400 p-4" i18n>
      Need help?
      <a class="ml-2" target="_blank"
        href="https://kcls.org/faq/interlibrary-loan-suggest-a-purchase/">
        See our FAQ (https://kcls.org/faq/interlibrary-loan-suggest-a-purchase/)
      </a>
    </div>

    <div *ngIf="requests.requestSubmitted && !controls.format.value" 
      class="mt-5 flex justify-center border rounded border-grey-400 p-4">
      <div>
        <p class="font-bold" i18n>Request successfully submitted.</p>
        <p class="mt-3" i18n>View your requests <a routerLink="/requests/list">here</a>.</p>
      </div>
    </div>
  </div>

  <div class="flex-1"></div>
</div>

